apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    operator: varnish
    varnish-component: proxy-sidecar-configmap
    varnish-owner: varnishcluster-example
  name: proxy-sidecar-config
data:
  haproxy.cfg: |+
    frontend localhost
      # Only bind on 80 if you also want to listen for connections on 80
      bind *:80
      bind *:443
      option tcplog
      mode tcp
      default_backend nodes

    resolvers localdns
      parse-resolv-conf
      hold valid 10s

    backend nodes
      mode tcp
      balance roundrobin
      option ssl-hello-chk
      source 0.0.0.0 usesrc clientip
      server mb01 api.mapbox.com:443 resolvers localdns check inter 1000
