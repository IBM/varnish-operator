// This file is generated. Do not edit manually, as changes will be destroyed

import directors;

{{ if .IPs -}}
{{ range $index, $IP := .IPs -}}
backend container{{ $index }} {
  .host = "{{ $IP }}";
  .port = "{{ $.TargetPort }}";
}
{{- end }}
{{- else -}}
# Without this dummy backend, varnish will not compile the code
# This is a dummy, and should not be used anywhere
backend dummy {
  .host = "127.0.0.1";
  .port = "0";
}
{{- end }}

sub init_backends {
  // The line below is generated and creates a variable that is used to build custom logic
  // when the user configured the backends incorrectly. E.g. return a custom error page that indicates the issue.
  var.global_set("backendsConfigured", "{{ $.BackendsConfigured }}"); //only strings are allowed to be set globally

  new container_rr = directors.round_robin();
  {{- range $index, $_ := .IPs }}
  container_rr.add_backend(container{{ $index }});
  {{- end }}
}